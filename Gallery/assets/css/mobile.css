/* =========================================================================
   Prompt Vault — Mobile UI (CSS-only)
   - Pure black theme
   - Detail: move title+actions *under* hero (no DOM/JS changes)
   - Thumbs fill tiles; larger & uniform
   - Gallery 2 per row
   - Unsafe/write actions hidden on mobile
   ========================================================================= */
@media (max-width: 768px){

  :root{
    --m-nav-h: 56px;
  }

  html, body{
    background:#000;
    color:#e8e8e8;
  }

  /* Your mobile layer toggles this (no new JS required) */
  body.mobile-on{
    overflow:hidden;                 /* lock body; inner views scroll */
    background:#000;
  }

  /* Hide desktop chrome for a clean mobile canvas */
  body.mobile-on .topbar,
  body.mobile-on #filters,
  body.mobile-on .footer{
    display:none !important;
  }

  /* Keep app content scrollable while body is locked */
  body.mobile-on .page{
    height: calc(100vh - var(--m-nav-h));
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    background:#000;
  }

  /* ===================== RESULTS (list style) ===================== */
  .results{ background:#000; }
  .results .grid{
    grid-template-columns: 1fr !important;
    gap:10px !important;
    padding:10px;
    background:#000;
    -webkit-overflow-scrolling: touch;
  }
  .results .grid > *{
    background:#0a0a0a;
    border:1px solid rgba(255,255,255,.07);
    border-radius:14px;
    overflow:hidden;
  }
  .results .grid img{
    width:100%; height:auto; display:block; background:#000;
  }
  .results .grid [class*="title"], .results .grid h2, .results .grid h3{
    font-size:16px !important;
    line-height:1.2 !important;
    margin:8px 10px 10px !important;
    color:#fff !important;
  }
  /* Less noise on mobile cards */
  .results .grid .chips,
  .results .grid .meta,
  .results .grid .tags,
  .results .grid .labels{ display:none !important; }

  /* ===================== DETAIL VIEW (fullscreen) ===================== */
  /* The view already renders header -> gallery -> prompt on desktop.
     Here we *swap* header & gallery rows so the header becomes a caption
     band directly *under* the hero image — CSS-only. */
  #detailView[aria-hidden="false"],
  body.mobile-on #detailView:not([aria-hidden="true"]){
    position:fixed !important;
    inset:0 !important;
    z-index:9999 !important;
    display:grid !important;
    grid-template-rows:auto 1fr auto;   /* three rows; we reassign below */
    background:#000;
    padding-bottom:var(--m-nav-h);
    overflow-y:auto;
    -webkit-overflow-scrolling:touch;
    touch-action:pan-y;
  }

  /* Swap order: gallery first, then header as caption bar */
  #detailView .detail-gallery{ grid-row: 1; }
  #detailView .detail-header { grid-row: 2; }

  /* Caption strip styling (using your existing .detail-header) */

  /* hide "Back" inside the caption on mobile; you still have system/back gestures */


  #detailView #detailTags{ display:none !important; }


/* --- Caption strip: Title truly centered; Back & Actions centered on their sides --- */


/* --- Caption strip: equal gutters; title never overlaps; buttons stay side-by-side --- */
#detailView .detail-header{
  grid-row: 2;                                     /* under hero */
  position: relative;
  z-index: 2;
  display: grid;
  /* equal left/right gutters that expand; center column holds the title */
  grid-template-columns: minmax(0,1fr) auto minmax(0,1fr);
  align-items: center;
  padding: 10px 12px;
  background: rgba(0,0,0,.65);
  backdrop-filter: blur(8px);
  border-top: 1px solid rgba(255,255,255,.06);
  border-bottom: 1px solid rgba(255,255,255,.06);
}

/* Back button — clean, same height as other buttons, no wrapping */
#detailView .detail-header #detailBack{
  grid-column: 1;
  justify-self: center;                 /* centered in left gutter */
  display: inline-flex !important;
  align-items: center;
  gap: 8px;
  padding: 6px 10px;
  min-height: 36px;
  white-space: nowrap;
  border: 0;
  border-radius: 10px;
  color: #fff;
  font-size: 15px;
  line-height: 1.2;
  background: rgba(255,255,255,.10);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.08);
}
#detailView .detail-header #detailBack::before{
  content: "";
  display: inline-block;
  line-height: 1;
  font-size: 16px;
}

/* Title lives in the middle column and is truly centered */
#detailView .detail-title-area{
  grid-column: 2;                       /* the center column */
  min-width: 0;
}
#detailView #detailTitle{
  margin: 0;
  font-size: 17px;
  font-weight: 700;
  color: #fff;
  text-align: center;
  max-width: 100%;
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
}

/* Actions centered in the right gutter; same height */
#detailView .detail-actions{
  grid-column: 3;
  justify-self: center;                 /* centered in right gutter */
  display: inline-grid;
  grid-auto-flow: column;
  gap: 8px;
  align-items: center;
  white-space: nowrap;
}
#detailView .detail-actions .btn{
  background: rgba(255,255,255,.08);
  color: #fff;
  border: 0;
  border-radius: 10px;
  padding: 6px 10px;
  min-height: 36px;
}



  /* Hero area */
  #detailView .detail-gallery{ position:relative; overflow:hidden; background:#000; }
  #detailView #detailHero{
    height: calc(100vh - 200px);     /* trims wasted gap to make room for caption & thumbs */
    display:grid; place-items:center; background:#000;
  }
  #detailView #detailImg{
    width:100%; height:100%; object-fit:contain; background:#000;
  }

  /* ===================== THUMB STRIP ===================== */
  #detailView #detailThumbsWrap{
    position:sticky; bottom:0;
    background:linear-gradient(to top, rgba(0,0,0,.85), rgba(0,0,0,0));
    padding:10px 6px 6px; z-index:3;
  }
  #detailView #detailThumbs{
    display:grid !important;
    grid-auto-flow:column; grid-auto-columns:max-content;
    align-items:center; gap:10px;
    overflow-x:auto; -webkit-overflow-scrolling:touch; scrollbar-width:none;
    touch-action:pan-x;
  }
  #detailView #detailThumbs::-webkit-scrollbar{ display:none; }

  /* Fix the "inset image" bug: tile has no inner padding; image fills it */
  #detailView #detailThumbs .m-item,
  #detailView #detailThumbs .thumb,
  #detailView #detailThumbs .m-thumb-wrap{
    padding:0 !important; margin:0 !important;
    width:96px !important; height:96px !important;
    border-radius:12px !important; overflow:hidden !important;
    background:#0b0b0b !important;
  }
  #detailView #detailThumbs img,
  #detailView #detailThumbs .m-thumb{
    width:100% !important; height:100% !important;
    object-fit:cover !important; display:block !important;
    border-radius:12px !important; transform:none !important; background:#000 !important;
  }
  #detailView #detailThumbs img.active,
  #detailView #detailThumbs .m-thumb.active{
    outline:2px solid #5ca8ff !important; outline-offset:2px !important;
  }

  /* ===================== PROMPT TEXT ===================== */
  #detailView .detail-prompt{
    max-height:40vh; overflow:auto; background:#0a0a0a;
    border-top:1px solid rgba(255,255,255,.08); padding:10px 12px;
  }

  /* ===================== GALLERY VIEW (2 per row) ===================== */
  #galleryView[aria-hidden="false"]{
    position:fixed !important; inset:0 !important; z-index:9999 !important;
    display:grid !important; grid-template-rows:auto 1fr;
    background:#000; padding-bottom:var(--m-nav-h);
  }
  #galleryView .gallery-header{
    position:sticky; top:0; z-index:2;
    background:linear-gradient(to bottom, rgba(0,0,0,.9), rgba(0,0,0,.4));
    padding:10px;
  }
  #galleryGrid{
    overflow-y:auto; padding:10px;
    display:grid; grid-template-columns: repeat(2, 1fr); gap:10px;
    -webkit-overflow-scrolling:touch;
  }
  #galleryGrid img, #galleryGrid .g-img, #galleryGrid .card img{
    width:100%; height:auto; display:block; border-radius:12px; background:#000;
  }
  #gallerySentinel{ pointer-events:none; opacity:.6; }

  /* ===================== BOTTOM MOBILE BAR ===================== */
  .mbar{
    position:fixed; left:0; right:0; bottom:0;
    height:var(--m-nav-h);
    background:rgba(0,0,0,.84); backdrop-filter:blur(10px);
    border-top:1px solid rgba(255,255,255,.08);
    display:grid; grid-template-columns:repeat(4,1fr);
    z-index:10000;
    padding-bottom: env(safe-area-inset-bottom);
  }
  .mbar button{
    background:transparent; border:0; color:#e8e8e8; font:inherit;
    display:grid; place-items:center; gap:2px;
  }
  .mbar button[aria-current="true"]{ color:#fff; font-weight:700; }

  /* ===================== HIDE UNSAFE / WRITE ACTIONS ===================== */
  #detailDownloadImg, #detailAddImages, #detailRating,
  .nsfw-toggle, .content-rating, [data-rating-toggle],
  #newPromptBtn,
  [data-action="delete"], [data-action="remove"], [data-action="set-cover"],
  [title*="Delete"], [title*="Change main"], [title*="Set as cover"],
  [data-action="download-image"], [data-action="add-images"]{
    display:none !important;
  }

  /* Safe-area padding (iOS) */
  #detailView, #galleryView, body.mobile-on .page{
    padding-bottom: calc(var(--m-nav-h) + env(safe-area-inset-bottom));
  }

  /* Landscape tweak */
  @media (orientation: landscape){
    #detailView #detailHero{ height: calc(100vh - 170px); }
    #detailView #detailThumbs .m-item,
    #detailView #detailThumbs .m-thumb-wrap{ width:84px !important; height:84px !important; }
    #detailView #detailThumbs img, #detailView #detailThumbs .m-thumb{ border-radius:10px !important; }
  }
}
